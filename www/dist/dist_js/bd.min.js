angular.module('app',
  [
    'ionic',
    'templates',
    'app.welcome',
    'app.register',
    'app.login',
    'app.profile',
    'app.landing'
  ])


//.run(function($ionicPlatform) {
//    $ionicPlatform.ready(function() {
//      // Hide the accessory bar by default (remove this to show the accessory bar above the keyboard
//      // for form inputs)
//      if (window.cordova && window.cordova.plugins && window.cordova.plugins.Keyboard) {
//        cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);
//        cordova.plugins.Keyboard.disableScroll(true);
//
//      }
//      if (window.StatusBar) {
//        // org.apache.cordova.statusbar required
//        StatusBar.styleLightContent();
//      }
//    });
//  })

angular.module("templates", []).run(["$templateCache", function($templateCache) {$templateCache.put("feed.html","<ion-view title=\"Feed\" ng-init=\"init()\">\n  <ion-content>\n    <div ng-repeat=\"data in feed.feedData\">\n      <div class=\"list card\" ng-if=\"feed.data.hasOwnProperty(\'message\')\">\n        <div class=\"item item-avatar\">\n          <img ng-src=\"{{feed.feedData.myPicture}}\">\n          <h2>{{feed.data.from.name}}</h2>\n          <p>{{feed.data.created_time}}</p>\n        </div>\n        <div class=\"item item-body\">\n          <p>\n            {{feed.data.message}}\n          </p>\n          <p>\n            <a href=\"#\" class=\"subdued\">{{feed.data.likes.data.length}} Likes</a>\n            <a href=\"#\" class=\"subdued\">{{feed.data.comments.data.length}} Comments</a>\n          </p>\n        </div>\n        <div class=\"item tabs tabs-secondary tabs-icon-left\">\n          <a class=\"tab-item\" href=\"#\">\n            <i class=\"icon ion-thumbsup\"></i>\n            Like\n          </a>\n          <a class=\"tab-item\" href=\"#\">\n            <i class=\"icon ion-chatbox\"></i>\n            Comment\n          </a>\n          <a class=\"tab-item\" href=\"#\">\n            <i class=\"icon ion-share\"></i>\n            Share\n          </a>\n        </div>\n      </div>\n    </div>\n  </ion-content>\n</ion-view>\n");
$templateCache.put("landing.html","Hello\n");
$templateCache.put("login.html","<div class=\"content\">\n  <!--<button class=\"button button-energized\" ng-click=\"addImage()\">-->\n  <!--Add image-->\n  <!--</button><br><br>-->\n\n  <!--<img ng-repeat=\"image in images\" ng-src=\"{{urlForImage(image)}}\" height=\"200px\"/>-->\n  <form ng-submit=\"login.loginUser()\">\n\n    <div class=\"list\">\n      <label class=\"item item-input item-floating-label\">\n        <span class=\"input-label\">Email</span>\n        <input type=\"text\" placeholder=\"Email\" ng-model=\"register.user.email\">\n      </label>\n      <label class=\"item item-input item-floating-label\">\n        <span class=\"input-label\">Password</span>\n        <input type=\"password\" placeholder=\"Password\" ng-model=\"register.user.password\">\n      </label>\n    </div>\n    <div class=\"padding\">\n      <button  class=\"button button-block button-positive\">Login</button>\n      <button ng-click=\"login.facebook()\" target=\"_self\">Login With facebook !</button>\n    </div>\n  </form>\n\n</div>\n\n\n");
$templateCache.put("profile.html","<ion-view title=\"Profile\" ng-init=\"init()\">\n  <ion-content>\n    <div class=\"list card\">\n      <div class=\"item item-avatar\">\n        <img ng-src=\"{{profile.profileData.picture.data.url}}\">\n        <h2>{{profile.profileData.name}}</h2>\n        <p>{{profile.profileData.id}}</p>\n      </div>\n      <a href=\"#\" class=\"item item-icon-left\">\n        <i class=\"icon ion-earth\"></i>\n        {{profile.profileData.website}}\n      </a>\n      <a href=\"#\" class=\"item item-icon-left\">\n        <i class=\"icon ion-home\"></i>\n        {{profile.profileData.location.name}}\n      </a>\n      <a href=\"#\" class=\"item item-icon-left\">\n        <i class=\"icon ion-heart\"></i>\n        {{profile.profileData.relationship_status}}\n      </a>\n    </div>\n  </ion-content>\n</ion-view>\n");
$templateCache.put("register.html","<div class=\"content\">\n    <!--<button class=\"button button-energized\" ng-click=\"addImage()\">-->\n      <!--Add image-->\n    <!--</button><br><br>-->\n<h1>Hi</h1>\n      <!--<img ng-repeat=\"image in images\" ng-src=\"{{urlForImage(image)}}\" height=\"200px\"/>-->\n  <a ng-href=\"/login\" > Login if you have an account already !</a>\n<form ng-submit=\"register.addUser()\">\n\n  <div class=\"list\">\n    <label class=\"item item-input item-floating-label\">\n      <span class=\"input-label\">Name</span>\n      <input type=\"text\" placeholder=\"Name\" ng-model=\"register.user.name\">\n    </label>\n    <label class=\"item item-input item-floating-label\">\n      <span class=\"input-label\">Email</span>\n      <input type=\"text\" placeholder=\"Email\" ng-model=\"register.user.email\">\n    </label>\n    <label class=\"item item-input item-floating-label\">\n      <span class=\"input-label\">Password</span>\n      <input type=\"password\" placeholder=\"Password\" ng-model=\"register.user.password\">\n    </label>\n    <label class=\"item item-input item-floating-label\">\n      <span class=\"input-label\">Age</span>\n      <input type=\"number\" placeholder=\"Age\" ng-model=\"register.user.age\">\n    </label>\n    <label class=\"item item-input item-floating-label\">\n      <span class=\"input-label\">Gender</span>\n      <input type=\"text\" placeholder=\"Gender\" ng-model=\"register.user.gender\">\n    </label>\n  </div>\n  <div class=\"padding\">\n    <button  class=\"button button-block button-positive\">Create Greatness</button>\n   </div>\n\n</form>\n\n</div>\n\n\n");
$templateCache.put("welcome.html","<ion-pane id=\"welcome\" class=\"welcomePane\">\n    <h1 class=\"title\">Dare to Take the first step to changing your life!!</h1>\n\n   <ion-footer-bar>\n    <a class=\"full_width button button-assertive\" ui-sref=\"register\">\n     Lets Go\n   </a>\n   </ion-footer-bar>\n\n</ion-pane>\n");}]);
(function () {
  //'use strict';

  angular.module('app')
    .config(['$stateProvider', '$urlRouterProvider','$locationProvider', Config]);

  function Config($stateProvider, $urlRouterProvider, $locationProvider) {

    $stateProvider

      // setup an abstract state for the tabs directive
      .state('welcome', {
        url: '/',
        controller : 'welcomeCtrl',
        templateUrl: 'welcome.html',
        controllerAs: 'welcome'
      })

      .state('register', {
        url: '/register',
        controller: 'registerCtrl as register',
        templateUrl: 'register.html',
       // controllerAs: 'register'
      })

      .state('login', {
        url: '/login',
        controller: 'loginCtrl as login',
        templateUrl: 'login.html',
      })

      .state('landing', {
        url:'/landing',
        controller: 'landingCtrl as landing',
        templateUrl: 'landing.html'
      })

      .state('profile', {
        url:'/profile',
        controller: 'profileCtrl as profile',
        templateUrl: 'profile.html'
      })

      .state('feed', {
        url:'/feed',
        controller: 'feedCtrl as feed',
        templateUrl: 'feed.html'
      });

    // if none of the above states are matched, use this as the fallback
    $urlRouterProvider.otherwise('/');
   // $locationProvider.html5Mode(true);
  }
}());

(function(){
  'use strict';

  angular.module('app.profile', ['ngCordova'])

.controller("feedCtrl",'$http', '$localStorage', '$location', function( $http, $localStorage, $location) {

  this.init = function() {
    if($localStorage.hasOwnProperty("accessToken") === true) {
      $http.get("https://graph.facebook.com/v2.2/me/feed", { params: { access_token: $localStorage.accessToken, format: "json" }}).then(function(result) {
        this.feedData = result.data.data;
        $http.get("https://graph.facebook.com/v2.2/me", { params: { access_token: $localStorage.accessToken, fields: "picture", format: "json" }}).then(function(result) {
          this.feedData.myPicture = result.data.picture.data.url;
        });
      }, function(error) {
        alert("There was a problem getting your profile.  Check the logs for details.");
        console.log(error);
      });
    } else {
      alert("Not signed in");
      $location.path("/login");
    }
  };

});

}());

(function(){
  'use strict';

  angular.module('app.login', ['ngCordova'])

    .controller('loginCtrl' ,['loginUserService', '$location','$cordovaOauth','$window', function(loginUserService, $location, $cordovaOauth, $window){

      this.facebook = function() {
        $cordovaOauth.facebook("519087128259422", ["email"]).then(function(result) {
          $window.localStorage.accessToken = result.access_token;
          $location.path("/profile");
        }, function(error) {
          alert("There was a problem signing in!  See the console for logs");
          console.log(error);
        });
     };

    }])

    .service('loginUserService', ['$http', '$location', function($http, $location){
      this.userInfo = function() {
       $http({
          url: 'http://localhost:3000/auth/facebook',
          method: 'GET'
         })
          .then(function(data, status, headers, config){
            console.log('Success!');
            return data;
            // called when the data is available
          },
          function(data, status, headers, config) {
            console.log('Failure :(');
            return data;
            // called when an error occurs or
            // the server returns data with an error status
          });
      };
    }]);

}());

(function(){
  'use strict';

 angular.module('app.profile', ['ngCordova'])

.controller('profileCtrl', '$http', '$localStorage', '$locationfunction', function( $http, $localStorage, $location) {

  this.init = function() {
    if($localStorage.hasOwnProperty("accessToken") === true) {
      $http.get("https://graph.facebook.com/v2.2/me", { params: { access_token: $localStorage.accessToken, fields: "id,name,gender,location,website,picture,relationship_status", format: "json" }}).then(function(result) {
        $scope.profileData = result.data;
      }, function(error) {
        alert("There was a problem getting your profile.  Check the logs for details.");
        console.log(error);
      });
    } else {
      alert("Not signed in");
      $location.path("/login");
    }
  };

});


}());

(function(){
  'use strict';

  angular.module('app.landing', [])

    .controller('landingCtrl' , function(){


    });

}());

(function(){
  'use strict';

  angular.module('app.register', [])

    .controller('registerCtrl' ,['registerUserService', function(registerUserService){

      this.user ={};

     this.addUser = function() {
        console.log(this.user);
        registerUserService.createUser(this.user).then(function(response) {
            console.log("You got to the place ", response);
        })
     };
    }])

    .service('registerUserService', ['$http', '$location', function($http, $location){
      this.createUser = function(user) {
        var data = user;
        $http({
          url: 'http://localhost:3000/user/signup',
          method: 'POST',
          data: data,
        })
          .then(function(data, status, headers, config){
            console.log('Success!');
            return data;
            // called when the data is available
          },
          function(data, status, headers, config) {
            console.log('Failure :(');
            // called when an error occurs or
            // the server returns data with an error status
          });
      };
     }])

}());

(function() {
  'use strict';
  angular.module('ionic.utils', [])

    .factory('$localstorage', ['$window', function ($window) {
      return {
        set: function (key, value) {
          $window.localStorage[key] = value;
        },
        get: function (key, defaultValue) {
          return $window.localStorage[key] || defaultValue;
        },
        setObject: function (key, value) {
          $window.localStorage[key] = JSON.stringify(value);
        },
        getObject: function (key) {
          return JSON.parse($window.localStorage[key] || '{}');
        }
      }
    }]);

}());

(function () {
  //'use strict';

  angular.module('app.welcome', [])

    .controller('welcomeCtrl' , function(){

      console.log('Hi Welcome');
    })



}());
